<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="/src/icon/wspnicon.ico">
  <title>WSPN DSK</title>
  <link rel="stylesheet" href="css/keyer.css" />
</head>
<body>
  <div id="coder">
  </div>
  <div id="base1"></div>

  <script>
    const ws = new WebSocket('ws://localhost:5000');
    let coderElement = null;
    
    // ✅ coder 생성 함수
    function inject() {
      const container = document.getElementById('coder');
    
      const div = document.createElement('div');
      div.className = 'coder'; // 초기엔 fade-in 부여
      div.innerHTML = `
            <div class="tnsc">
              <div class="away-tn"><p id="awayTeam">AWAY</p></div>
              <div class="away-sc"><p id="awayScore">0</p></div>
              <div class="home-tn"><p id="homeTeam">HOME</p></div>
              <div class="home-sc"><p id="homeScore">0</p></div>
            </div>
      `;
    
      container.appendChild(div);

      void div.offsetWidth;
      div.classList.add('fade-in');

      coderElement = div;
    }
    
    // ✅ 메시지 수신 처리
    ws.onmessage = (event) => {
      const msg = event.data;
      const container = document.getElementById('coder');
    
      // coder-on: inject 실행
      if (msg === 'coder-on') {
        if (!coderElement) {
          inject();
        }
      }
    
      // coder-off: fade-out 후 제거
      if (msg === 'coder-off') {
        if (coderElement) {
          coderElement.classList.remove('fade-in');
          coderElement.classList.add('fade-out');
    
          setTimeout(() => {
            if (coderElement && container.contains(coderElement)) {
              container.removeChild(coderElement);
              coderElement = null;
            }
          }, 500);
        }
      }
    
      // 점수 업데이트
      try {
        const data = JSON.parse(event.data);
        if (data.type === 'score-update') {
          document.getElementById('awayTeam').innerText = data.payload.awayTeam;
          document.getElementById('homeTeam').innerText = data.payload.homeTeam;
          document.getElementById('awayScore').innerText = data.payload.awayScore;
          document.getElementById('homeScore').innerText = data.payload.homeScore;
        }
      } catch (e) {
        // 문자열일 경우 무시
      }
    };
    </script>
</body>
</html>
